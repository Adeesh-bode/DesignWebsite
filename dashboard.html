<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<style>
    /* Style for dashboard entries */
    .dashboard-entry {
        display: flex;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ccc;
    }
    .dashboard-entry:last-child {
        border-bottom: none;
    }
    .dashboard-entry .delete-icon {
        margin-left: auto;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="dashboard" class="container">
    <h1 class="text-center">Dashboard</h1>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <input type="password" id="fetchInput" class="form-control mb-3" placeholder="Enter authentication code">
        </div>
        <div class="col-md-6">
            <button onclick="fetchData();" class="btn btn-primary mb-3">Fetch Entries</button>
        </div>
    </div>
</div>

<script>
    const fetchData = async () => {
        const input = document.getElementById('fetchInput').value;
        if(input !== '@Admin123') {
            alert('Authentication failed!');
            return;
        }
        const response = await fetch(`https://xceedesigns-backend.vercel.app/contact/fetch`);
        const data = await response.json();
        
        const table = document.createElement('table');
        table.classList.add('table');

        // Remove previous table if exists
        const previousTable = document.querySelector('table');
        if (previousTable) {
            previousTable.remove();
        }

        const tableHead = document.createElement('thead');
        const tableHeadRow = document.createElement('tr');
        const nameHeader = document.createElement('th');
        nameHeader.textContent = 'Name';
        tableHeadRow.appendChild(nameHeader);
        const emailHeader = document.createElement('th');
        emailHeader.textContent = 'Email';
        tableHeadRow.appendChild(emailHeader);
        const messageHeader = document.createElement('th');
        messageHeader.textContent = 'Message';
        tableHeadRow.appendChild(messageHeader);
        const deleteHeader = document.createElement('th');
        deleteHeader.textContent = 'Delete';
        tableHeadRow.appendChild(deleteHeader);
        tableHead.appendChild(tableHeadRow);
        table.appendChild(tableHead);

        const tableBody = document.createElement('tbody');
        data.forEach(entry => {
            const tableRow = document.createElement('tr');

            const nameCell = document.createElement('td');
            nameCell.textContent = entry.name;
            tableRow.appendChild(nameCell);

            const emailCell = document.createElement('td');
            emailCell.textContent = entry.email;
            tableRow.appendChild(emailCell);

            const messageCell = document.createElement('td');
            messageCell.textContent = entry.message;
            tableRow.appendChild(messageCell);

            const deleteCell = document.createElement('td');
            const deleteIcon = document.createElement('div');
            deleteIcon.classList.add('delete-icon');
            deleteIcon.textContent = '🗑️';
            deleteIcon.style.cursor = 'pointer';
            deleteIcon.addEventListener('click', async() => {
                const res = await fetch(`https://xceedesigns-backend.vercel.app/contact/delete/${entry._id}`, {
                    method: 'DELETE'
                });
                tableRow.remove();
                
            });
            deleteCell.appendChild(deleteIcon);
            tableRow.appendChild(deleteCell);

            tableBody.appendChild(tableRow);
        });
        table.appendChild(tableBody);

        document.getElementById('dashboard').appendChild(table);
    };
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

</body>
</html>
